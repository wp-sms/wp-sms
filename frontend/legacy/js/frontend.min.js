(()=>{jQuery(document).ready((function(){e.init(),jQuery(".wpsms-sendSmsForm").each((function(){s.init(this)}))}));var e={init:function(){this.info=[],this.setFields(),this.setEventListener()},getGroupId:function(e){var s=[],t=e.find('input[name="group_id_checkbox"]'),n=e.find('select[name="group_id_select"]');return t.each((function(){this.checked&&s.push(this.value)})),n&&n.val()&&s.push(n.val()),s.length?s:[]},setFields:function(){this.wpSmsGdprCheckbox=jQuery(".js-wpSmsGdprConfirmation"),this.wpSmsEventType=jQuery(".js-wpSmsSubscribeType"),this.wpSmsSubmitTypeButton=jQuery(".js-wpSmsSubmitTypeButton"),this.mandatoryVerify=jQuery(".js-wpSmsMandatoryVerify").val()},sendSubscriptionForm:function(e){var s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this,t=e.find(".js-wpSmsSubmitButton"),n=e.find(".js-wpSmsSubscribeMessage"),i=e.find(".js-wpSmsSubscribeOverlay"),a=e.find(".js-wpSmsSubscribeStepOne"),r=e.find(".js-wpSmsSubmitButton"),p=e.find(".js-wpSmsSubscribeStepTwo"),u=e.find(".js-wpSmsSubscriberCustomFields"),o=e.find(".js-wpSmsSubscriberMobile");t.prop("disabled",!0),n.hide(),i.css("display","flex");var d=new FormData;d.append("name",e.find(".js-wpSmsSubscriberName input").val()),d.append("mobile",o.find(".iti--show-flags").length>0?o.find("input.wp-sms-input-mobile").val():o.find("input").val());var c=this.getGroupId(e);c.length>0&&d.append("group_id",JSON.stringify(c)),d.append("type",e.find(".js-wpSmsSubscribeType:checked").val()),u.each((function(){var e=jQuery(this).data("field-name"),s=jQuery(this).find("input").val();d.append("custom_fields[".concat(e,"]"),s)}));var m="subscribe"===d.get("type")?wpsms_ajax_object.subscribe_ajax_url:wpsms_ajax_object.unsubscribe_ajax_url;jQuery.ajax({type:"POST",url:m,contentType:!1,processData:!1,data:d,beforeSend:function(){t.prop("disabled",!0).text(wpsms_ajax_object.loading_text)},complete:function(){t.prop("disabled",!1).text(wpsms_ajax_object.subscribe_text)},success:function(e){t.prop("disabled",!1),i.hide(),n.fadeIn().html('<span class="wpsms-subscribe__message wpsms-subscribe__message--success">'+e.data+"</span>"),a.hide(),"subscribe"===d.get("type")&&"1"===s.mandatoryVerify&&(r.prop("disabled",!0),p.show())},error:function(e){t.prop("disabled",!1),i.hide(),n.fadeIn().html('<span class="wpsms-subscribe__message wpsms-subscribe__message--error">'+e.responseJSON.data+"</span>")}}),s.info=Object.fromEntries(d.entries())},sendActivationCode:function(e){var s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this,t=e.find(".js-wpSmsActivationButton"),n=(e.parents(".js-wpSmsSubscribeFormContainer"),e.find(".js-wpSmsSubscribeMessage")),i=e.find(".js-wpSmsSubscribeOverlay"),a=e.find(".js-wpSmsSubscribeStepTwo");t.prop("disabled",!0),n.hide(),i.css("display","flex"),s.info.activation=e.find(".js-wpSmsActivationCode").val();var r=new FormData;for(var p in s.info)s.info.hasOwnProperty(p)&&r.append(p,s.info[p]);jQuery.ajax({type:"POST",url:wpsms_ajax_object.verify_subscribe_ajax_url,contentType:!1,processData:!1,data:r,beforeSend:function(){t.prop("disabled",!0).text(wpsms_ajax_object.loading_text)},complete:function(){t.prop("disabled",!1).text(wpsms_ajax_object.activation_text)},success:function(e){t.prop("disabled",!1),i.hide(),n.fadeIn().html('<span class="wpsms-subscribe__message wpsms-subscribe__message--success">'+e.data+"</span>"),a.hide()},error:function(e){t.prop("disabled",!1),i.hide(),n.fadeIn().html('<span class="wpsms-subscribe__message wpsms-subscribe__message--error">'+e.responseJSON.data+"</span>")}})},setEventListener:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this;this.wpSmsGdprCheckbox.on("change",(function(){jQuery(this).parents(".js-wpSmsSubscribeFormField").nextAll(".js-wpSmsSubmitButton").first().prop("disabled",!this.checked)})),this.wpSmsEventType.on("click",(function(){jQuery(this).parents(".js-wpSmsSubscribeFormField").nextAll(".js-wpSmsSubmitButton").first().text(jQuery(this).data("label"))})),this.wpSmsSubmitTypeButton.on("click",(function(s){s.preventDefault(),jQuery(this).hasClass("js-wpSmsSubmitButton")&&e.sendSubscriptionForm(jQuery(this).parents(".js-wpSmsSubscribeForm")),jQuery(this).hasClass("js-wpSmsActivationButton")&&e.sendActivationCode(jQuery(this).parents(".js-wpSmsSubscribeForm"))}))}},s={init:function(e){e=jQuery(e),this.setSendSmsBlockFields(e)},setSendSmsBlockFields:function(e){var s=e.find("input[name=subscriberGroup]"),t=e.find("input[type=submit]"),n=e.find("textarea.wpsms-sendSmsForm__messageField"),i=e.find("input[name=receiver]"),a=e.find("input.wpsms-sendSmsForm__receiverField"),r=e.find("p.wpsms-sendSmsForm__messageField__alert"),p=e.find("div.wpsms-sendSmsForm__resultMessage"),u=e.find("div.wpsms-sendSmsForm__overlay"),o=n.data("max"),d={SBSubscriberGroup:s,SBSubmit:t,SBMessage:n,SBReceiver:i,SBPhoneNumber:a,SBMessageAlert:r,SBResult:p,SBOverlay:u,SBMaxCount:o};this.setSendSmsBlockEventListeners(d)},setSendSmsBlockEventListeners:function(e){jQuery(e.SBSubmit).on("click",(function(s){s.preventDefault();var t=new FormData;t.append("sender",wpsms_ajax_object.sender),t.append("recipients",e.SBReceiver.val()),t.append("message",e.SBMessage.val()),t.append("group_ids",e.SBSubscriberGroup.val()),t.append("numbers",e.SBPhoneNumber.val()),t.append("maxCount",e.SBMaxCount),jQuery.ajax({url:wpsms_ajax_object.front_sms_endpoint_url,method:"POST",contentType:!1,cache:!1,processData:!1,data:t,beforeSend:function(){jQuery(e.SBResult).text("").fadeOut().removeClass("failed success"),jQuery(e.SBOverlay).fadeIn()},success:function(s){jQuery(e.SBResult).text(s.data).fadeIn().addClass("success"),jQuery(e.SBMessage).val("").trigger("input"),jQuery(e.SBOverlay).fadeOut()},error:function(s){var t=s.responseJSON.data&&s.responseJSON.data.message?s.responseJSON.data.message:s.responseJSON.data||"An unexpected error occurred.";jQuery(e.SBResult).text(t).fadeIn().addClass("failed"),jQuery(e.SBOverlay).fadeOut()}})})),jQuery(e.SBMessage).on("input",(function(){var s=jQuery(this).val().length,t=e.SBMaxCount-s;s>=e.SBMaxCount-8?(jQuery(e.SBMessageAlert).fadeIn(),jQuery(e.SBMessageAlert).find("span").text(t)):jQuery(e.SBMessageAlert).fadeOut()}))}}})();